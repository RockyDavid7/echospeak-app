<section class="section" id="stories">
  <h2>Interactive Stories</h2>
  <p>Echo and Mike take you on fun journeys around Puerto Rico and the U.S.! Hear the story, repeat the words, and learn together.</p>

  <div class="story-card">
    <h3>Echo at the Market / Echo en el Mercado</h3>
    <p id="line1">Echo goes to the market in San Juan. / Echo va al mercado en San Juan.</p>
    <button onclick="speakLine('Echo goes to the market in San Juan. Echo va al mercado en San Juan.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line1')">ğŸ¤ Repeat</button>

    <p id="line2">He sees mangoes and bananas. / Ve mangos y plÃ¡tanos.</p>
    <button onclick="speakLine('He sees mangoes and bananas. Ve mangos y plÃ¡tanos.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line2')">ğŸ¤ Repeat</button>

    <p id="line3">He buys three bananas. / Compra tres plÃ¡tanos.</p>
    <button onclick="speakLine('He buys three bananas. Compra tres plÃ¡tanos.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line3')">ğŸ¤ Repeat</button>

    <p id="line4">Echo says, "Yum!" / Echo dice, "Â¡QuÃ© rico!"</p>
    <button onclick="speakLine('Echo says, Yum! Echo dice, Â¡QuÃ© rico!', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line4')">ğŸ¤ Repeat</button>
  </div>

  <div class="story-card">
    <h3>Mike's Picture / El Cuadro de Miguel</h3>
    <p id="line5">Mike wants to find a beautiful picture. / Miguel quiere encontrar una imagen hermosa.</p>
    <button onclick="speakLine('Mike wants to find a beautiful picture. Miguel quiere encontrar una imagen hermosa.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line5')">ğŸ¤ Repeat</button>

    <p id="line6">He goes to Chicago. / Ã‰l va a Chicago.</p>
    <button onclick="speakLine('He goes to Chicago. Ã‰l va a Chicago.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line6')">ğŸ¤ Repeat</button>

    <p id="line7">He forgets to find the picture. / Ã‰l se olvida de encontrar la imagen.</p>
    <button onclick="speakLine('He forgets to find the picture. Ã‰l se olvida de encontrar la imagen.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line7')">ğŸ¤ Repeat</button>

    <p id="line8">He is sad. / Ã‰l estÃ¡ triste.</p>
    <button onclick="speakLine('He is sad. Ã‰l estÃ¡ triste.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line8')">ğŸ¤ Repeat</button>

    <p id="line9">He takes the train to New York. / Ã‰l toma el tren a Nueva York.</p>
    <button onclick="speakLine('He takes the train to New York. Ã‰l toma el tren a Nueva York.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line9')">ğŸ¤ Repeat</button>

    <p id="line10">Mike changes his money. / Miguel cambia su dinero.</p>
    <button onclick="speakLine('Mike changes his money. Miguel cambia su dinero.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line10')">ğŸ¤ Repeat</button>

    <p id="line11">He goes to Central Park. / Ã‰l va a Central Park.</p>
    <button onclick="speakLine('He goes to Central Park. Ã‰l va a Central Park.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line11')">ğŸ¤ Repeat</button>

    <p id="line12">Mike buys a beautiful picture. / Miguel compra una imagen hermosa.</p>
    <button onclick="speakLine('Mike buys a beautiful picture. Miguel compra una imagen hermosa.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line12')">ğŸ¤ Repeat</button>

    <p id="line13">The picture has flowers, trees, and a lake. / La imagen tiene flores, Ã¡rboles y un lago.</p>
    <button onclick="speakLine('The picture has flowers, trees, and a lake. La imagen tiene flores, Ã¡rboles y un lago.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line13')">ğŸ¤ Repeat</button>

    <p id="line14">He hangs the picture on the wall. / Ã‰l cuelga la imagen en la pared.</p>
    <button onclick="speakLine('He hangs the picture on the wall. Ã‰l cuelga la imagen en la pared.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line14')">ğŸ¤ Repeat</button>

    <p id="line15">Now, he is very happy. / Ahora, Ã©l estÃ¡ muy feliz.</p>
    <button onclick="speakLine('Now, he is very happy. Ahora, Ã©l estÃ¡ muy feliz.', 'en')">ğŸ”Š Hear it</button>
    <button onclick="listenAndRepeat('line15')">ğŸ¤ Repeat</button>
  </div>
</section>

<script>
function speakLine(text, langCode = 'en-US') {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = langCode === 'en' ? 'en-US' : 'es-PR';
  speechSynthesis.speak(utterance);
}

function listenAndRepeat(id) {
  if (!('webkitSpeechRecognition' in window)) {
    alert("Speech recognition not supported on this browser.");
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = id.includes('es') ? 'es-PR' : 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onresult = function(event) {
    const result = event.results[0][0].transcript;
    alert(`You said: "${result}" â€” Great job!`);
  };

  recognition.onerror = function() {
    alert("Oops! Please try again.");
  };

  recognition.start();
}
</script>
